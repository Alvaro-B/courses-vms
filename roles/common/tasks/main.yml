##################################
#   _     ___ _   _ _   ___  __  #
#  | |   |_ _| \ | | | | \ \/ /  #
#  | |    | ||  \| | | | |\  /   #
#  | |___ | || |\  | |_| |/  \   #
#  |_____|___|_| \_|\___//_/\_\  #
##################################                                               

- name: Install and configure basics for Linux
  block:
    - import_tasks: linux-modify-repository-url.yml
      when:
        change_mirror 

    - name: test default graphical distro
      shell: systemctl get-default
      register: default_runlevel
      changed_when: false

    - import_tasks: linux-common.yml

    - import_tasks: linux-disable-lock-screen.yml

    - import_tasks: linux-terminal-shortcuts.yml

    - import_tasks: linux-users.yml

    - import_tasks: linux-lang.yml
      when: ansible_distribution == 'CentOS'

    - import_tasks: linux-timezone.yml
      when: ansible_distribution == 'CentOS'

    - import_tasks: linux-remove-keyring.yml
      when: ansible_distribution == 'Fedora'

    - import_tasks: linux-install-desktop-environment.yml
      when: 
        - ansible_distribution == 'CentOS'
        - default_runlevel.stdout == 'graphical.target'

    - import_tasks: linux-disable-zram.yml

    - import_tasks: linux-locale-and-keyboard-settings.yml
      when: ansible_distribution == 'Fedora' and ansible_distribution_major_version == '37'

    - import_tasks: linux-disable-autorun-aplications-on-login.yml
      when: ansible_distribution == 'Fedora' 

  when:
    - ansible_windows_domain is undefined

#######################################################
#  __        _____ _   _ ____   _____        ______   #
#  \ \      / /_ _| \ | |  _ \ / _ \ \      / / ___|  #
#   \ \ /\ / / | ||  \| | | | | | | \ \ /\ / /\___ \  #
#    \ V  V /  | || |\  | |_| | |_| |\ V  V /  ___) | #
#     \_/\_/  |___|_| \_|____/ \___/  \_/\_/  |____/  #
####################################################### 

- name: Windows common
  block:
    - import_tasks: windows-license.yml
    - import_tasks: windows-disable-automatic-updates.yml
    - import_tasks: windows-disable-pass-complexity.yml
    - import_tasks: windows-user.yml
    - name: Reboot and loggin as {{base_username}}
      win_reboot:
    - import_tasks: windows-firewall.yml
    - import_tasks: windows-common-sw.yml
  when: 
    - ansible_windows_domain is defined
